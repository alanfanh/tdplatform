{% extends 'base.html' %}

{% load staticfiles %}

{% block title %}培训管理{% endblock  %}

{% block content %}
{% comment %} <link rel="stylesheet" href="{% static 'css/training/training.css' %}">
<link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
<div class="all-container">
    <div class="uk-container">
        <div class="side-bar">
            <div class="bar1">
            <!--改动-->
               <div class="menu1_icon"></div>
             <!--改动-->
                <a href="#" class="menu1 btn-default" role="button">培训</a>
            </div>
            <div class="bar2">
                <a href="#" class="menu2 btn-default" role="button">积分</a>
            </div>
        </div>
        <div class="mid">
            <img src="{% static 'images/training/mid.svg' %}" alt="" class="separate">
        </div>
        <div class="content">
            <div class="title">
                <span>培训</span>
            </div>
            <div class="group1 default">
                <span>搜索范围：</span>
            </div>
            <div class="group2 default">
                <select id="group-select" class="department form-control default" style="font-size: 13px;">
                    <option selected value="测试部" class="select_option">测试部</option>
                    <option value="1" class="">1</option>
                </select>
            </div>
            <div class="time1 default">
                <span>时间选择：</span>
            </div>
            <div class="time2 default">
                <select id="time-year" class="year form-control default" style="font-size: 13px;">
                    <option value="2020">2020</option>
                </select>
            </div>
            <div class="search default">
                <input type="text" id="search1" value="请输入">
            </div>
            <div class="addbutton">
                {% if userinfo.role_id == 3 or userinfo.role_id == 4 %}
                <a href="{% url 'training:add_course' %}"><button id="add">添加</button></a>
                {% endif %}
            </div>
            <div class="table-train">
                <table class="table table-text table-hover">
                    <thead class="thead-style">
                        <tr>
                            <th><input type="checkbox" id=all onclick=""></th>
                            <th>序号</th>
                            <th>名称</th>
                            <th>培训范围</th>
                            <th>主讲人</th>
                            <th>参加成员</th>
                            <th>培训地址</th>
                            <th>培训时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="checkbox" name="box" onclick=""></td>
                            <td>1</td>
                            <td>RF框架-架构篇</td>
                            <td>商用测试组</td>
                            <td>李测试</td>
                            <td>19人</td>
                            <td>5楼5号会议室</td>
                            <td>2019/12/08</td>
                            <td>
                                <div class="operate">
                                    <a name="look-over">查看</a>
                                    <a name="download">下载</a>
                                    <img src="{% static 'images/training/button.png' %}" href="#" class="img-button">
                                </div>
                            </td>
                        </tr>
                        {% for course in courses %}
                        <tr>
                            <td><input type="checkbox" name="box" onclick=""></td>
                            <td>{{forloop.counter}}</td>
                            <td>{{course.cname}}</td>
                            <td>{{course.range}}</td>
                            <td>{{course.teacher}}</td>
                            <td></td>
                            <td>{{course.address}}</td>
                            <td>{{course.course_time}}</td>
                            <td>
                                <div class="operate">
                                    <a name="look-over">查看</a>
                                    <a name="download">下载</a>
                                    <img src="{% static 'images/training/button.png' %}" href="#" class="img-button">
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="page-foot">
                <div class="data-num"></div>
                
            </div>
        </div>
    </div>
</div>
{% endcomment %}


<link rel="stylesheet" href="{% static 'css/account/admin_group.css' %}">
<link rel="stylesheet" href="{% static 'css/account/manager.css' %}">
<link rel="stylesheet" href="{% static 'css/training/train.css' %}">

<div class="base">
    <div class="tnbaseplate">
        <div class="menuinfo">
            <div class="gmenu_cp1">
                <span class="left_bd"></span>
                <a href="{% url 'training:course_list' %}"><span class="chpract">培训课程</span></a>
            </div>
            <div class="gmenu_cp2">
                <a href="{% url 'training:point_list' %}"><span class="m_mdata">积分展示</span></a>
            </div>
        </div>
        <div class="info_base">
            <div class="Cp_title">
                <span class="Cust_Com">培训课程</span>
            </div>
            <div class="tnseltinfo">
                <label for="" class="sortrg">搜索范围：</label>
                <select class="rgselect" onchange="selectGroup()" id="selectGroup">
                    <option value="测试部">测试部</option>
                    <option value="自动化开发组">自动化开发组</option>
                    <option value="接入测试组">接入测试组</option>
                    <option value="家用测试组">家用测试组</option>
                    <option value="商用测试组">商用测试组</option>
                    <option value="便携测试组">便携测试组</option>
                    <option value="资料开发组">资料开发组</option>
                    <option value="OEM测试组">OEM测试组</option>
                </select>
                <label for="" class="gptime">时间选择：</label>
                <select class="gptimepick" onchange="selectCTime()" id="selectCTime">
                    <option value="2019">2019</option>
                    <option value="2020">2020</option>
                </select>
                <input type="text" class="trsearch" placeholder="请输入" id="search-course">
                <img src="{% static 'images/training/sort.svg' %}" id="btn3" class="trsortimg">
                <img src="{% static 'images/asset/handle.svg' %}" class="trsthandle">
                {% if userinfo.role_id == 3 or userinfo.role_id == 4 %}
                <a href="{% url 'training:add_course' %}"><button class="adcustomer" type="button">添加</button></a>
                {% endif %}
            </div>
            {% comment %}
            <table class="tntable" align="center">
                <thead>
                    <tr class="gd_th">
                        <td class="tntd1">
                            <input type="checkbox" class="tnck">
                        </td>
                        <td class="tntd2">序号</td>
                        <td class="tntd3">名称</td>
                        <td class="tntd4">培训范围</td>
                        <td class="tntd5">主讲人</td>
                        <td class="tntd6">参加成员</td>
                        <td class="tntd7">培训地址</td>
                        <td class="tntd8">培训时间</td>
                        <td class="tntd9">操作</td>
                    </tr>
                </thead>
                <tbody>
                    <tr class="tntr">
                        <td class="tntd1">
                            <input type="checkbox" class="tnck">
                        </td>
                        <td>1</td>
                        <td>
                            <span class="sign"></span>
                            <span class="Cust_cont">RF框架-架构篇</span>
                        </td>
                        <td>商用测试组</td>
                        <td>李测试</td>
                        <td>
                            <span>19人</span>
                            <span class="sign"></span>
                        </td>
                        <td>5楼5号会议室</td>
                        <td>2019/12/08</td>
                        <td>
                            <span class="dload"><a href="">查看</a> | <a href="">下载</a></span>
                            <img src="{% static 'images/asset/see.png' %}" class="see_dload">
                        </td>
                    </tr>
                    {% for course in courses %}
                    <tr class="tntr">
                        <td class="tntd1">
                            <input type="checkbox" class="tnck">
                        </td>
                        <td>{{forloop.counter}}</td>
                        <td>
                            <span class="sign"></span>
                            <span class="Cust_cont">{{course.cname}}</span>
                        </td>
                        <td>{{course.range}}</td>
                        <td>{{course.teacher.realname}}</td>
                        <td>
                            <span>{{course.student.all.count}}人</span>
                            <span class="sign"></span>
                        </td>
                        <td>{{course.address}}</td>
                        <td>{{course.course_time|date:"Y/m/d H:i"}}</td>
                        <td>
                            <span class="dload">
                                <a href="{% url 'training:course_detail' course.id %}">查看</a> | {% if course.file_name != "" %}<a href="{% url 'training:download_file' course.id %}">下载</a>{% endif %}
                            </span>
                            <a onclick="showTipbox(this)" style="position: relative;">
                                <img src="{% static 'images/asset/see.png' %}" class="see_dload">
                                <div class="tip_box" style="display: none;">
                                    <div class="tip_content">
                                        <span>删除</span>
                                        <span>编辑</span>
                                    </div>
                                </div>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                    <tr class="tntr">
                        <td class="tntd1">
                            <input type="checkbox" class="tnck">
                        </td>
                        <td>8</td>
                        <td>
                            <span class="sign"></span>
                            <span class="Cust_cont">实验室资产管理平台定时发送邮件实现物品催…</span>
                        </td>
                        <td>自动化开发组</td>
                        <td>李家用</td>
                        <td>
                            <span>10人</span>
                            <span class="sign"></span>
                        </td>
                        <td>5楼5号会议室</td>
                        <td>2019/12/08</td>
                        <td>
                            <span class="dload">查看 | 下载</span>
                            
                        </td>
                    </tr>
                </tbody>
            </table>
            {% endcomment %}
            <div style="position:absolute;left:25px;top:118px;"><table id="train_table" lay-filter="test"></table></div>
            {% comment %}
            <div class="tnfooter">
                <div class="cc_total">
                    <span>共计{{courses.count}}条数据</span>
                </div>
                <img src="{% static 'images/asset/left.png' %}" class="Ct_left">
                <div class="cc_page1">
                    <span class="Ct_pg1">1</span>
                </div>
                <div class="Ct_pg2">
                    <span>2</span>
                </div>
                <div class="Ct_pg3">
                    <span>3</span>
                </div>
                <div class="Ct_pg4">
                    <span>4</span>
                </div>
                <div class="Ct_pg5">
                    <span>5</span>
                </div>
                <img src="images/admin/right.png" class="Ct_right">
                <button class="cc_page">
                    <span style="font-family:'ArialMT', 'Arial';">10</span>
                    <span style="font-family:'PingFangSC-Regular', 'PingFang SC';">条/页</span>
                    <img src="images/admin/right.png" class="Ct_img">
                </button>
                <div class="Ct_goto">
                    <span>前往第</span>
                </div>
                <input type="text" class="cc_input" placeholder="2">
                <div class="Ct_pages">
                    <span>页</span>
                </div>
            </div>
            {% endcomment %}
        </div>
    </div>
</div>
<script src="{% static '/layui/layui.js' %}"></script>
<script type="text/html" id="oper_tool">
  <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
  <a class="layui-btn layui-btn-xs" lay-event="download" >下载</a>
  {% if userinfo.role.role_name == "PL" %}
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  {% endif %}
</script>
<script type="text/html" id="add_tool">
  <div class="layui-btn-container">
    <button class="layui-btn layui-btn-sm" lay-event="add">添加</button>
    <button class="layui-btn layui-btn-sm" lay-event="delete">删除</button>
    <button class="layui-btn layui-btn-sm" lay-event="update">编辑</button>
  </div>
</script>
<script>
function showTipbox(target) {
    $el = $(target).find(".tip_box");
    if ($el.is(':visible')) {
        $el.hide()
    } else {
        $el.show()
    }
};
layui.use(['laypage', 'layer', 'table', 'element'], function () {
    var table = layui.table  // 表格
        , layer = layui.layer     // 弹窗
        , laypage = layui.laypage;    // 分页

    //table实例
    table.render({
        elem: '#train_table'
        , height: 512
        , url: '/training/course-list-data/' //数据接口
        , page: true //开启分页
        , limit: 10
        //, even: true
        //, skin: 'line'
        , cols: [[ //表头
            { field: 'id', title: 'ID', width: 60, sort: true, }
            , { field: 'cname', title: '课程名', width: 343 }
            , { field: 'range', title: '课程范围', width: 120 }
            , { field: 'teacher', title: '主讲人', width: 96, sort: true }
            , { field: 'number', title: '参加人数', width: 100, sort: true }
            , { field: 'address', title: '培训地点', width: 134 }
            , { field: 'course_time', title: '培训时间', width: 149 }
            , { field: '', title: '操作', toolbar: "#oper_tool" }
        ]]
    });

    // table行工具栏事件
    table.on('tool(test)', function (obj) {
        var data = obj.data, layEvent = obj.event;
        console.log(data)
        if (layEvent === 'detail') {
            window.location.href = "/training/course-detail/" + data.id
        } else if (layEvent === 'download') {
            window.location.href = "/training/download-coursefile/" + data.id
        }
    });

});

function selectGroup(){
    var range = $("#selectGroup").val()
    layui.use(['table'], function(){
        var table = layui.table  // 表格
        table.reload('train_table', {
            url: '/training/filter-course-list/'
            ,where: { range: range } //设定异步数据接口的额外参数
            //,height: 300
        });
    });
};

function selectCTime() {
    var year = $("#selectCTime").val()
    layui.use(['table'], function(){
        var table = layui.table  // 表格
        table.reload('train_table', {
            url: '/training/filter-course-list/'
            ,where: { year: year } //设定异步数据接口的额外参数
            //,height: 300
        });
    });
}

$("#btn3").on('click', function() {
    var search_key = $("#search-course").val()
    if(search_key != "") {
        layui.use(['table'], function(){
            var table = layui.table  // 表格
            table.reload('train_table', {
                url: '/training/search-course/'
                ,where: { search: search_key } //设定异步数据接口的搜索的关键字
                //,height: 300
            });
        });
    } else {
        window.location.href="/training/course-list/"
    }
})

/*
function delete_course(the, course_id){
    var name = $(the).parents("tr").children("td").eq(1).text();
    layer.open({
        type:1,
        skin:"layui-layer-rim",
        area:["400px","200px"],
        title:"删除栏目",
        content:'<div class="text-center" style="margin-top:20px"><p>是否确定删除?</p></div>',
        btn:['确定','取消'],
        yes: function(){
            $.ajax({
                url:'/training/delete-course/',
                type:'POST',
                data:{"pk":course_id},
                success: function(e){
                    if (e=="1") {
                        parent.location.reload();
                        layer.msg("has been deleted");
                    } else {
                        layer.msg("删除成功");
                    }
                },
            })
        },
    });
};
*/


</script>
{% endblock  %}